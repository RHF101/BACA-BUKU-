<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading Haven - Koleksi Buku</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo">Reading Haven</div>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="login.html" id="login-link">Login</a>
            <a href="#" id="logout-link" style="display: none;">Logout</a>
            <!-- <a href="admin.html" id="admin-link" style="display: none;">Admin</a> -->
        </div>
    </nav>

    <!-- Main Content -->
    <main>
        <section id="free-collection">
            <h2>ðŸ“– Koleksi Gratis</h2>
            <div class="grid" id="free-grid">
                <p class="placeholder">Sedang memuat koleksi gratis...</p>
            </div>
        </section>

        <section id="premium-collection">
            <h2>ðŸ’Ž Koleksi Premium</h2>
            <div class="grid" id="premium-grid">
                <p class="placeholder">Sedang memuat koleksi premium...</p>
            </div>
        </section>
    </main>

    <!-- Firebase + Auth + Database langsung di sini -->
    <script type="module">
        // Import SDK yang dibutuhkan
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";

        // Config Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCs7Vnysf25BwhN2-fPTODd48xwzbPkbzI",
            authDomain: "rhf-shop-mafia-8d2e5.firebaseapp.com",
            databaseURL: "https://rhf-shop-mafia-8d2e5-default-rtdb.firebaseio.com",
            projectId: "rhf-shop-mafia-8d2e5",
            storageBucket: "rhf-shop-mafia-8d2e5.firebasestorage.app",
            messagingSenderId: "158711184948",
            appId: "1:158711184948:web:9223f07fa6658601189461",
            measurementId: "G-R6KN1EYMB3"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // Update navbar berdasarkan status login
        onAuthStateChanged(auth, user => {
            const loginLink = document.getElementById('login-link');
            const logoutLink = document.getElementById('logout-link');

            if (user) {
                loginLink.style.display = 'none';
                logoutLink.style.display = 'inline-block';
            } else {
                loginLink.style.display = 'inline-block';
                logoutLink.style.display = 'none';
            }
        });

        // Handler logout
        document.getElementById('logout-link').addEventListener('click', e => {
            e.preventDefault();
            signOut(auth).then(() => {
                location.href = 'login.html';
            });
        });

        // Load buku dari Realtime Database
        async function loadBooks() {
            const freeGrid = document.getElementById('free-grid');
            const premiumGrid = document.getElementById('premium-grid');

            freeGrid.innerHTML = '';
            premiumGrid.innerHTML = '';

            try {
                const snapshot = await get(ref(db, 'books'));
                const books = snapshot.val() || {};

                let hasFree = false;
                let hasPremium = false;

                Object.entries(books).forEach(([id, book]) => {
                    if (book.status !== 'published') return;

                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <img src="\( {book.coverURL || 'https://via.placeholder.com/280x340?text=Cover'}" alt=" \){book.title}">
                        <div class="card-content">
                            <h3>${book.title}</h3>
                            <p>${book.author || 'Tidak diketahui'}</p>
                            ${book.category === 'gratis' 
                                ? '<span class="label-gratis">Gratis</span><a href="read.html?id=' + id + '" class="btn">Baca Sekarang</a>'
                                : '<p>Rp ' + (book.price || 0).toLocaleString('id-ID') + '</p><a href="detail.html?id=' + id + '" class="btn">Lihat Detail</a>'}
                        </div>
                    `;

                    if (book.category === 'gratis') {
                        freeGrid.appendChild(card);
                        hasFree = true;
                    } else if (book.category === 'premium') {
                        premiumGrid.appendChild(card);
                        hasPremium = true;
                    }
                });

                if (!hasFree) freeGrid.innerHTML = '<p class="placeholder">Belum ada buku gratis yang tersedia</p>';
                if (!hasPremium) premiumGrid.innerHTML = '<p class="placeholder">Belum ada buku premium yang tersedia</p>';
            } catch (err) {
                console.error("Gagal memuat buku:", err);
                freeGrid.innerHTML = premiumGrid.innerHTML = '<p class="placeholder">Gagal memuat koleksi. Coba refresh halaman.</p>';
            }
        }

        // Jalankan load buku setelah halaman siap
        window.addEventListener('load', loadBooks);
    </script>
</body>
</html>
