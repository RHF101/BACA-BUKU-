const bookSnap = await get(ref(db, `books/${bookId}`));
const book = bookSnap.val();

if (!book) {
  document.getElementById('content').innerHTML = '<p>Buku tidak ditemukan</p>';
  return;
}

if (book.category === 'gratis') {
  document.getElementById('content').innerHTML = book.content || '<p>Isi buku kosong</p>';
} else {
  // Cek login & pembelian
  if (!user) {
    document.getElementById('content').innerHTML = '<p style="color:red">Login dulu untuk membaca buku premium</p>';
  } else {
    const userSnap = await get(ref(db, `users/${user.uid}`));
    const userData = userSnap.val();
    if (userData.purchasedBooks && userData.purchasedBooks[bookId]) {
      document.getElementById('content').innerHTML = book.content || '<p>Isi buku kosong</p>';
    } else {
      document.getElementById('content').innerHTML = '<p style="color:red">Beli buku ini untuk membaca isi lengkap</p>';
    }
  }
}
